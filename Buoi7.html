<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buổi 7: Java Exception Handling - Xử lý Ngoại lệ</title>
    <style>
        :root {
            --bg: #0d1117;
            --panel: #161b22;
            --border: #21262d;
            --text: #c9d1d9;
            --muted: #8b949e;
            --accent: #58a6ff;
            --accent-2: #1f6feb;
            --success: #238636;
            --warning: #d29922;
            --error: #f85149;
            --line: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            overflow: hidden;
            font-size: 16px;
        }

        .slides {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 40px 60px 100px 60px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg);
            overflow-y: auto;
            box-sizing: border-box;
        }

        .slide.active {
            opacity: 1;
            transform: translateX(0);
        }

        .slide.prev {
            transform: translateX(-100%);
        }

        /* Typography */
        h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            line-height: 1.2;
        }

        h2 {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 8px;
            line-height: 1.3;
        }

        h3 {
            font-size: 1.3em;
            font-weight: 600;
            margin: 12px 0 8px;
            color: var(--accent-2);
            line-height: 1.3;
        }

        h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin: 10px 0 6px;
            color: var(--text);
        }

        p {
            font-size: 1.05em;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        ul, ol {
            font-size: 1em;
            margin: 10px 0;
            padding-left: 20px;
        }

        li {
            margin-bottom: 4px;
            line-height: 1.5;
        }

        /* Code styling */
        pre {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            overflow-x: auto;
            font-size: 0.85em;
            line-height: 1.4;
            max-height: 320px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
        }

        code.inline {
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            background: var(--panel);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: var(--accent);
        }

        /* Highlighting */
        mark {
            background: var(--warning);
            color: var(--bg);
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .highlight-error {
            background: var(--error);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .highlight-success {
            background: var(--success);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        /* Layout components */
        .callout {
            background: var(--panel);
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent);
            padding: 16px;
            margin: 12px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .callout.warning {
            border-left-color: var(--warning);
        }

        .callout.error {
            border-left-color: var(--error);
        }

        .callout.success {
            border-left-color: var(--success);
        }

        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 12px 0;
            align-items: start;
        }

        .three-columns {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin: 12px 0;
            align-items: start;
        }

        /* Exception hierarchy visual */
        .exception-tree {
            background: var(--panel);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            font-family: monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }

        .exception-tree .level-0 { color: var(--accent); font-weight: bold; }
        .exception-tree .level-1 { color: var(--text); margin-left: 20px; }
        .exception-tree .level-2 { color: var(--muted); margin-left: 40px; }

        /* Interactive elements */
        .toggle-content {
            margin-top: 12px;
        }

        .toggle-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .toggle-btn:active {
            transform: translateY(0);
        }

        .content-section {
            display: none;
            margin-top: 10px;
            animation: slideDown 0.3s ease;
        }

        .content-section.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 0.95em;
            background: var(--panel);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--border);
            font-weight: 600;
            color: var(--accent);
        }

        tr:hover {
            background: rgba(88, 166, 255, 0.05);
        }

        /* Icons and visual elements */
        .icon {
            font-size: 1.2em;
            margin-right: 8px;
            display: inline-block;
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-success { background: var(--success); }
        .status-error { background: var(--error); }
        .status-warning { background: var(--warning); }

        /* Code comparison */
        .code-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 12px 0;
        }

        .code-block {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .code-header {
            background: var(--border);
            padding: 8px 12px;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--accent);
        }

        .code-header.error { color: var(--error); }
        .code-header.success { color: var(--success); }

        .code-content {
            padding: 12px;
            font-size: 0.85em;
            font-family: monospace;
            line-height: 1.4;
        }

        /* Footer controls */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(22, 27, 34, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .button {
            background: var(--panel);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-weight: 500;
        }

        .button:hover {
            background: var(--border);
            transform: translateY(-1px);
        }

        .button:active {
            transform: translateY(0);
        }

        .button[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress {
            height: 4px;
            background: var(--panel);
            border-radius: 2px;
            overflow: hidden;
            width: 200px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .progress > span {
            display: block;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .help {
            font-size: 0.8em;
            color: var(--muted);
        }

        /* Responsive design */
        @media (max-width: 1200px) {
            .slide {
                padding: 30px 40px 90px 40px;
            }
            h1 { font-size: 2.2em; }
            h2 { font-size: 1.8em; }
            .two-columns { gap: 16px; }
            .three-columns { gap: 12px; }
        }

        @media (max-width: 900px) {
            .slide {
                padding: 25px 30px 85px 30px;
            }
            h1 { font-size: 2em; }
            h2 { font-size: 1.6em; }
            .two-columns { 
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .three-columns { 
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .code-comparison {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        @media (max-height: 700px) {
            .slide {
                padding: 20px 40px 80px 40px;
            }
            h1 { font-size: 2em; }
            h2 { font-size: 1.6em; }
            p, ul, ol { font-size: 0.95em; }
            pre { max-height: 250px; }
        }

        /* Print styles */
        @media print {
            body, .slides, .slide {
                position: static;
                height: auto;
                overflow: visible;
            }
            .slide {
                page-break-after: always;
                opacity: 1 !important;
                transform: none !important;
            }
            .footer { display: none; }
        }
    </style>
</head>

<body>
    <div class="slides" id="deck">
        <!-- Slide 1: Title -->
        <section class="slide active">
            <h1>Java Exception Handling</h1>
            <p style="text-align: center; font-size: 1.4em; color: var(--muted); margin-bottom: 30px;">Xử lý ngoại lệ - Làm chủ lỗi trong Java</p>
            
            <div style="text-align: center; margin-top: 20px;">
                <p style="font-size: 1.1em; margin-bottom: 20px;">Exception Handling là kỹ năng <mark>không thể thiếu</mark> trong lập trình Java chuyên nghiệp. Nó giúp bạn:</p>
                
                <div class="three-columns" style="max-width: 900px; margin: 30px auto;">
                    <div class="callout success">
                        <h3><span class="icon">🛡️</span>Bảo vệ</h3>
                        <p>Ngăn chương trình crash khi gặp lỗi</p>
                    </div>
                    <div class="callout">
                        <h3><span class="icon">🔍</span>Chẩn đoán</h3>
                        <p>Hiểu rõ nguyên nhân và vị trí lỗi</p>
                    </div>
                    <div class="callout warning">
                        <h3><span class="icon">🚀</span>Phục hồi</h3>
                        <p>Tự động khôi phục và tiếp tục hoạt động</p>
                    </div>
                </div>

                <div style="background: var(--panel); padding: 20px; border-radius: 12px; margin: 30px auto; max-width: 700px;">
                    <h3>📚 Nội dung buổi học:</h3>
                    <ol style="text-align: left; font-size: 1.05em; line-height: 1.8;">
                        <li>Khái niệm Exception & Exception Hierarchy</li>
                        <li>Try-Catch-Finally Blocks</li>
                        <li>Checked vs Unchecked Exceptions</li>
                        <li>Throwing & Custom Exceptions</li>
                        <li>Best Practices & Real-world Examples</li>
                        <li>Try-with-Resources (Modern Java)</li>
                    </ol>
                </div>

                <p style="color: var(--muted); margin-top: 30px; font-size: 0.9em;">
                    <span class="icon">⌨️</span>Sử dụng phím <code class="inline">←</code> <code class="inline">→</code> hoặc <code class="inline">Space</code> để điều hướng
                </p>
            </div>
        </section>

        <!-- Slide 2: Exception là gì? -->
        <section class="slide">
            <h2>1. Exception là gì?</h2>
            
            <div class="callout">
                <p><strong>Definition:</strong> Exception (Ngoại lệ) là một <mark>sự kiện bất thường</mark> xảy ra trong quá trình thực thi chương trình, làm gián đoạn luồng bình thường của chương trình.</p>
            </div>

            <div class="two-columns">
                <div>
                    <h3>🔥 Ví dụ Exception thường gặp:</h3>
                    <ul>
                        <li><strong>ArithmeticException:</strong> Chia cho 0</li>
                        <li><strong>NullPointerException:</strong> Gọi method trên null</li>
                        <li><strong>ArrayIndexOutOfBoundsException:</strong> Index vượt quá mảng</li>
                        <li><strong>FileNotFoundException:</strong> File không tồn tại</li>
                        <li><strong>NumberFormatException:</strong> Convert string lỗi</li>
                    </ul>

                    <h3>⚡ Tại sao cần Exception Handling?</h3>
                    <ul>
                        <li><span class="status-icon status-error"></span>Tránh crash chương trình</li>
                        <li><span class="status-icon status-warning"></span>Cung cấp thông tin lỗi hữu ích</li>
                        <li><span class="status-icon status-success"></span>Khôi phục hoạt động bình thường</li>
                    </ul>
                </div>
                <div>
                    <h3>💥 Chương trình KHÔNG xử lý Exception:</h3>
                    <pre><code>public class BadExample {
    public static void main(String[] args) {
        int result = 10 / 0;  // ☠️ ArithmeticException
        System.out.println("This will never print!");
    }
}</code></pre>
                    <div class="callout error">
                        <strong>Kết quả:</strong> Chương trình crash và dừng hoàn toàn!
                    </div>

                    <h3>✅ Chương trình CÓ xử lý Exception:</h3>
                    <pre><code>public class GoodExample {
    public static void main(String[] args) {
        try {
            int result = 10 / 0;  // Exception xảy ra
        } catch (ArithmeticException e) {
            System.out.println("Lỗi: " + e.getMessage());
        }
        System.out.println("Chương trình tiếp tục chạy!");
    }
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Slide 3: Exception Hierarchy -->
        <section class="slide">
            <h2>2. Exception Hierarchy (Phân cấp Exception)</h2>
            
            <p>Java có một hệ thống phân cấp Exception rất rõ ràng:</p>
            
            <div class="exception-tree">
                <div class="level-0">java.lang.Throwable</div>
                <div class="level-1">├── java.lang.Error (Lỗi hệ thống - không xử lý được)</div>
                <div class="level-2">│   ├── OutOfMemoryError</div>
                <div class="level-2">│   ├── StackOverflowError</div>
                <div class="level-2">│   └── VirtualMachineError</div>
                <div class="level-1">└── java.lang.Exception (Có thể xử lý được)</div>
                <div class="level-2">    ├── RuntimeException (Unchecked Exception)</div>
                <div class="level-2">    │   ├── NullPointerException</div>
                <div class="level-2">    │   ├── ArithmeticException</div>
                <div class="level-2">    │   ├── ArrayIndexOutOfBoundsException</div>
                <div class="level-2">    │   └── IllegalArgumentException</div>
                <div class="level-2">    └── Checked Exceptions</div>
                <div class="level-2">        ├── IOException</div>
                <div class="level-2">        ├── SQLException</div>
                <div class="level-2">        └── ClassNotFoundException</div>
            </div>

            <div class="two-columns">
                <div class="callout error">
                    <h3>🔥 Error vs Exception</h3>
                    <p><strong>Error:</strong> Lỗi nghiêm trọng của hệ thống (OutOfMemoryError, StackOverflowError) - <mark>không nên</mark> và <mark>không thể</mark> xử lý.</p>
                    <p><strong>Exception:</strong> Lỗi có thể xử lý được trong quá trình chạy chương trình.</p>
                </div>
                <div class="callout">
                    <h3>📝 Phân loại chính:</h3>
                    <ul>
                        <li><strong>Checked Exception:</strong> Bắt buộc phải handle hoặc declare</li>
                        <li><strong>Unchecked Exception:</strong> Không bắt buộc handle (RuntimeException)</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Slide 4: Try-Catch-Finally -->
        <section class="slide">
            <h2>3. Try-Catch-Finally Blocks</h2>
            
            <div class="callout">
                <h3>📐 Cú pháp cơ bản:</h3>
                <pre><code>try {
    // Code có thể gây exception
} catch (ExceptionType e) {
    // Xử lý exception
} finally {
    // Code luôn chạy (optional)
}</code></pre>
            </div>

            <div class="two-columns">
                <div>
                    <h3>🎯 Try Block</h3>
                    <ul>
                        <li>Chứa code có thể gây exception</li>
                        <li>Nếu exception xảy ra → nhảy ngay sang catch</li>
                        <li>Nếu không có exception → bỏ qua catch</li>
                    </ul>

                    <h3>🎪 Catch Block</h3>
                    <ul>
                        <li>Xử lý exception cụ thể</li>
                        <li>Có thể có nhiều catch cho các exception khác nhau</li>
                        <li>Exception con phải đặt trước exception cha</li>
                    </ul>

                    <h3>🔒 Finally Block</h3>
                    <ul>
                        <li>Luôn chạy dù có exception hay không</li>
                        <li>Thường dùng để cleanup (đóng file, database...)</li>
                        <li>Chỉ không chạy khi System.exit() hoặc JVM crash</li>
                    </ul>
                </div>
                <div>
                    <h3>💡 Ví dụ thực tế:</h3>
                    <pre><code>public class DivisionCalculator {
    public static double divide(int a, int b) {
        try {
            System.out.println("Đang thực hiện phép chia...");
            double result = a / b;
            System.out.println("Phép chia thành công!");
            return result;
            
        } catch (ArithmeticException e) {
            System.out.println("❌ Lỗi: Không thể chia cho 0!");
            System.out.println("Chi tiết: " + e.getMessage());
            return Double.NaN;  // Not a Number
            
        } finally {
            System.out.println("🔄 Hoàn tất phép toán");
        }
    }
    
    public static void main(String[] args) {
        double result1 = divide(10, 2);   // Bình thường
        System.out.println("Kết quả: " + result1);
        
        double result2 = divide(10, 0);   // Exception
        System.out.println("Kết quả: " + result2);
    }
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Slide 5: Bài tập Try-Catch -->
        <section class="slide">
            <h2>🏋️ Bài tập 1: Try-Catch-Finally</h2>
            
            <div class="callout">
                <h3>📋 Đề bài:</h3>
                <p>Viết chương trình quản lý mảng số nguyên với các chức năng:</p>
                <ol>
                    <li>Nhập index và hiển thị phần tử tại vị trí đó</li>
                    <li>Xử lý exception khi index vượt quá mảng</li>
                    <li>Xử lý exception khi nhập chuỗi thay vì số</li>
                    <li>Sử dụng finally để thông báo kết thúc</li>
                </ol>
            </div>

            <div class="toggle-content">
                <button class="toggle-btn" onclick="toggleContent(this, 'code1')">📝 Xem Code</button>
                <button class="toggle-btn" onclick="toggleContent(this, 'result1')">🖥️ Kết Quả</button>

                <div id="code1" class="content-section">
                    <pre><code>import java.util.Scanner;
import java.util.InputMismatchException;

public class ArrayManager {
    private static int[] numbers = {10, 20, 30, 40, 50};
    
    public static void displayElement(int index) {
        try {
            System.out.println("🔍 Đang truy cập phần tử tại index " + index);
            int element = numbers[index];
            System.out.println("✅ Phần tử tại index " + index + " là: " + element);
            
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("❌ Lỗi: Index " + index + " vượt quá kích thước mảng!");
            System.out.println("💡 Mảng chỉ có index từ 0 đến " + (numbers.length - 1));
            
        } finally {
            System.out.println("🔄 Hoàn tất thao tác truy cập mảng\n");
        }
    }
    
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        
        System.out.println("=== QUẢN LÝ MẢNG SỐ NGUYÊN ===");
        System.out.println("Mảng hiện tại: " + java.util.Arrays.toString(numbers));
        System.out.println("Kích thước mảng: " + numbers.length);
        
        while (true) {
            try {
                System.out.print("\nNhập index (hoặc -1 để thoát): ");
                int index = scanner.nextInt();
                
                if (index == -1) {
                    System.out.println("👋 Cảm ơn bạn đã sử dụng chương trình!");
                    break;
                }
                
                displayElement(index);
                
            } catch (InputMismatchException e) {
                System.out.println("❌ Lỗi: Vui lòng nhập một số nguyên!");
                System.out.println("💡 Bạn đã nhập: '" + scanner.next() + "'");
                System.out.println("🔄 Thử lại...\n");
                
            } finally {
                // Cleanup code có thể đặt ở đây nếu cần
            }
        }
        
        scanner.close();
    }
}</code></pre>
                </div>

                <div id="result1" class="content-section">
                    <pre><code>$ javac ArrayManager.java
$ java ArrayManager
=== QUẢN LÝ MẢNG SỐ NGUYÊN ===
Mảng hiện tại: [10, 20, 30, 40, 50]
Kích thước mảng: 5

Nhập index (hoặc -1 để thoát): 2
🔍 Đang truy cập phần tử tại index 2
✅ Phần tử tại index 2 là: 30
🔄 Hoàn tất thao tác truy cập mảng

Nhập index (hoặc -1 để thoát): 10
🔍 Đang truy cập phần tử tại index 10
❌ Lỗi: Index 10 vượt quá kích thước mảng!
💡 Mảng chỉ có index từ 0 đến 4
🔄 Hoàn tất thao tác truy cập mảng

Nhập index (hoặc -1 để thoát): abc
❌ Lỗi: Vui lòng nhập một số nguyên!
💡 Bạn đã nhập: 'abc'
🔄 Thử lại...

Nhập index (hoặc -1 để thoát): -1
👋 Cảm ơn bạn đã sử dụng chương trình!</code></pre>
                </div>
            </div>
        </section>

        <!-- Slide 6: Checked vs Unchecked Exceptions -->
        <section class="slide">
            <h2>4. Checked vs Unchecked Exceptions</h2>
            
            <div class="code-comparison">
                <div class="code-block">
                    <div class="code-header error">❌ Checked Exceptions</div>
                    <div class="code-content">
                        <strong>Đặc điểm:</strong><br>
                        • Bắt buộc handle hoặc declare<br>
                        • Compile-time checking<br>
                        • Kế thừa từ Exception (không phải RuntimeException)<br><br>
                        
                        <strong>Ví dụ:</strong><br>
                        • IOException<br>
                        • SQLException<br>
                        • ClassNotFoundException<br>
                        • FileNotFoundException
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header success">✅ Unchecked Exceptions</div>
                    <div class="code-content">
                        <strong>Đặc điểm:</strong><br>
                        • Không bắt buộc handle<br>
                        • Runtime checking<br>
                        • Kế thừa từ RuntimeException<br><br>
                        
                        <strong>Ví dụ:</strong><br>
                        • NullPointerException<br>
                        • ArithmeticException<br>
                        • ArrayIndexOutOfBoundsException<br>
                        • IllegalArgumentException
                    </div>
                </div>
            </div>

            <h3>🔍 So sánh chi tiết:</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tiêu chí</th>
                        <th>Checked Exception</th>
                        <th>Unchecked Exception</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Bắt buộc handle?</strong></td>
                        <td><span class="highlight-error">Có</span> (compile-time)</td>
                        <td><span class="highlight-success">Không</span> (runtime)</td>
                    </tr>
                    <tr>
                        <td><strong>Kế thừa từ</strong></td>
                        <td>Exception (không phải RuntimeException)</td>
                        <td>RuntimeException</td>
                    </tr>
                    <tr>
                        <td><strong>Khi nào xảy ra</strong></td>
                        <td>Lỗi ngoại lệ có thể dự đoán</td>
                        <td>Lỗi lập trình logic</td>
                    </tr>
                    <tr>
                        <td><strong>Ví dụ</strong></td>
                        <td>File không tồn tại, network lỗi</td>
                        <td>Chia 0, null pointer, array out of bounds</td>
                    </tr>
                    <tr>
                        <td><strong>Cách xử lý</strong></td>
                        <td>Phải try-catch hoặc throws</td>
                        <td>Có thể try-catch hoặc không</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Slide 7: Ví dụ Checked Exception -->
        <section class="slide">
            <h2>5. Ví dụ Checked Exception</h2>
            
            <div class="two-columns">
                <div>
                    <h3>❌ Code không compile được:</h3>
                    <pre><code>import java.io.*;

public class BadFileExample {
    public static void readFile() {
        // ❌ Compile ERROR!
        // Must handle IOException
        FileReader file = new FileReader("data.txt");
        BufferedReader reader = new BufferedReader(file);
        String line = reader.readLine();
        System.out.println(line);
    }
}</code></pre>
                    <div class="callout error">
                        <p><strong>Lỗi compile:</strong> Unreported exception java.io.IOException; must be caught or declared to be thrown</p>
                    </div>
                </div>
                <div>
                    <h3>✅ Code đúng - Handle Exception:</h3>
                    <pre><code>import java.io.*;

public class GoodFileExample {
    public static void readFile() {
        try {
            FileReader file = new FileReader("data.txt");
            BufferedReader reader = new BufferedReader(file);
            String line = reader.readLine();
            
            if (line != null) {
                System.out.println("Nội dung: " + line);
            } else {
                System.out.println("File rỗng");
            }
            
            reader.close();
            
        } catch (FileNotFoundException e) {
            System.out.println("❌ File không tồn tại!");
        } catch (IOException e) {
            System.out.println("❌ Lỗi đọc file: " + e.getMessage());
        }
    }
}</code></pre>
                </div>
            </div>

            <h3>🚀 Hoặc sử dụng throws declaration:</h3>
            <pre><code>import java.io.*;

public class ThrowsExample {
    // Khai báo throws - không handle ở đây
    public static void readFile(String filename) throws IOException {
        FileReader file = new FileReader(filename);
        BufferedReader reader = new BufferedReader(file);
        String line = reader.readLine();
        System.out.println(line);
        reader.close();
    }
    
    public static void main(String[] args) {
        try {
            readFile("data.txt");  // Phải handle ở đây
        } catch (IOException e) {
            System.out.println("❌ Lỗi: " + e.getMessage());
        }
    }
}</code></pre>
        </section>

        <!-- Slide 8: Multiple Catch Blocks -->
        <section class="slide">
            <h2>6. Multiple Catch Blocks & Catch Hierarchy</h2>
            
            <div class="callout">
                <p><strong>Quy tắc:</strong> Exception <mark>con phải đặt trước</mark> exception cha trong catch blocks!</p>
            </div>

            <div class="code-comparison">
                <div class="code-block">
                    <div class="code-header error">❌ Sai thứ tự</div>
                    <div class="code-content">
<pre><code>try {
    // some code
} catch (Exception e) {        // ❌ Cha trước
    System.out.println("General error");
} catch (IOException e) {      // ❌ Compile ERROR!
    System.out.println("IO error");  // Unreachable code
}</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header success">✅ Đúng thứ tự</div>
                    <div class="code-content">
<pre><code>try {
    // some code
} catch (FileNotFoundException e) {  // ✅ Con trước
    System.out.println("File not found");
} catch (IOException e) {            // ✅ Cha sau
    System.out.println("IO error");
} catch (Exception e) {              // ✅ Tổng quát nhất cuối
    System.out.println("General error");
}</code></pre>
                    </div>
                </div>
            </div>

            <h3>🔥 Ví dụ thực tế - File Processing:</h3>
            <pre><code>import java.io.*;
import java.util.Scanner;

public class FileProcessor {
    public static void processFile(String filename) {
        try {
            FileReader file = new FileReader(filename);
            Scanner scanner = new Scanner(file);
            
            while (scanner.hasNextLine()) {
                String line = scanner.nextLine();
                int number = Integer.parseInt(line);  // Có thể gây NumberFormatException
                System.out.println("Processed: " + (number * 2));
            }
            
            scanner.close();
            
        } catch (FileNotFoundException e) {
            System.out.println("❌ File '" + filename + "' không tồn tại!");
            System.out.println("💡 Kiểm tra lại đường dẫn file");
            
        } catch (NumberFormatException e) {
            System.out.println("❌ File chứa dữ liệu không phải số!");
            System.out.println("💡 Chi tiết: " + e.getMessage());
            
        } catch (IOException e) {
            System.out.println("❌ Lỗi đọc file: " + e.getMessage());
            
        } catch (Exception e) {
            System.out.println("❌ Lỗi không xác định: " + e.getMessage());
            e.printStackTrace();  // Debug info
        }
    }
}</code></pre>
        </section>

        <!-- Slide 9: Throwing Exceptions -->
        <section class="slide">
            <h2>7. Throwing Exceptions</h2>
            
            <div class="two-columns">
                <div>
                    <h3>🚀 Từ khóa throw</h3>
                    <p>Dùng để <mark>ném exception</mark> thủ công:</p>
                    <pre><code>public void validateAge(int age) {
    if (age < 0) {
        throw new IllegalArgumentException(
            "Tuổi không thể âm: " + age
        );
    }
    if (age > 150) {
        throw new IllegalArgumentException(
            "Tuổi quá lớn: " + age
        );
    }
    System.out.println("Tuổi hợp lệ: " + age);
}</code></pre>

                    <h3>📝 Từ khóa throws</h3>
                    <p>Khai báo method <mark>có thể ném exception</mark>:</p>
                    <pre><code>public void readFile(String filename) 
        throws IOException, FileNotFoundException {
    // Code có thể gây exception
    // Không handle ở đây, để caller handle
}</code></pre>
                </div>
                <div>
                    <h3>💡 Khi nào nên throw exception?</h3>
                    <ul>
                        <li><strong>Validate input:</strong> Tham số không hợp lệ</li>
                        <li><strong>Business logic:</strong> Vi phạm quy tắc nghiệp vụ</li>
                        <li><strong>State checking:</strong> Object ở trạng thái không hợp lệ</li>
                        <li><strong>Resource issues:</strong> Không thể truy cập resource</li>
                    </ul>

                    <h3>🔧 Ví dụ thực tế:</h3>
                    <pre><code>public class BankAccount {
    private double balance;
    
    public void withdraw(double amount) {
        if (amount < 0) {
            throw new IllegalArgumentException(
                "Số tiền rút không thể âm"
            );
        }
        if (amount > balance) {
            throw new RuntimeException(
                "Không đủ tiền. Số dư: " + balance
            );
        }
        balance -= amount;
        System.out.println("Rút " + amount + " thành công");
    }
}</code></pre>
                </div>
            </div>

            <div class="callout warning">
                <h3>⚠️ Lưu ý quan trọng:</h3>
                <ul>
                    <li><strong>throw:</strong> Ném exception ngay lập tức</li>
                    <li><strong>throws:</strong> Khai báo method có thể ném exception</li>
                    <li>Sau khi throw exception, code phía dưới sẽ không chạy</li>
                    <li>RuntimeException không cần khai báo trong throws</li>
                </ul>
            </div>
        </section>

        <!-- Slide 10: Custom Exceptions -->
        <section class="slide">
            <h2>8. Custom Exceptions</h2>
            
            <p>Tạo exception riêng để xử lý các trường hợp đặc biệt trong business logic:</p>

            <div class="two-columns">
                <div>
                    <h3>📝 Cách tạo Custom Exception:</h3>
                    <pre><code>// Custom Checked Exception
public class InsufficientFundsException extends Exception {
    private double balance;
    private double requestedAmount;
    
    public InsufficientFundsException(double balance, double requestedAmount) {
        super("Không đủ tiền! Số dư: " + balance + 
              ", yêu cầu: " + requestedAmount);
        this.balance = balance;
        this.requestedAmount = requestedAmount;
    }
    
    public double getBalance() { return balance; }
    public double getRequestedAmount() { return requestedAmount; }
}

// Custom Unchecked Exception  
public class InvalidAccountException extends RuntimeException {
    public InvalidAccountException(String message) {
        super(message);
    }
    
    public InvalidAccountException(String message, Throwable cause) {
        super(message, cause);
    }
}</code></pre>
                </div>
                <div>
                    <h3>🏦 Sử dụng Custom Exception:</h3>
                    <pre><code>public class BankAccount {
    private String accountNumber;
    private double balance;
    
    public BankAccount(String accountNumber, double initialBalance) {
        if (accountNumber == null || accountNumber.trim().isEmpty()) {
            throw new InvalidAccountException("Số tài khoản không hợp lệ");
        }
        this.accountNumber = accountNumber;
        this.balance = initialBalance;
    }
    
    public void withdraw(double amount) throws InsufficientFundsException {
        if (amount > balance) {
            throw new InsufficientFundsException(balance, amount);
        }
        balance -= amount;
        System.out.println("Rút " + amount + " thành công");
    }
    
    public static void main(String[] args) {
        try {
            BankAccount account = new BankAccount("123456", 1000);
            account.withdraw(1500);  // Gây InsufficientFundsException
            
        } catch (InsufficientFundsException e) {
            System.out.println("❌ " + e.getMessage());
            System.out.println("💡 Số dư hiện tại: " + e.getBalance());
            System.out.println("💡 Số tiền yêu cầu: " + e.getRequestedAmount());
        }
    }
}</code></pre>
                </div>
            </div>

            <div class="callout">
                <h3>💡 Best Practices cho Custom Exception:</h3>
                <ul>
                    <li><strong>Tên rõ ràng:</strong> Kết thúc bằng "Exception"</li>
                    <li><strong>Thông tin hữu ích:</strong> Cung cấp thêm context data</li>
                    <li><strong>Constructor đầy đủ:</strong> message, cause, và custom fields</li>
                    <li><strong>Documentation:</strong> Javadoc giải thích khi nào throw</li>
                </ul>
            </div>
        </section>

        <!-- Slide 11: Bài tập Custom Exception -->
        <section class="slide">
            <h2>🏋️ Bài tập 2: Custom Exception</h2>
            
            <div class="callout">
                <h3>📋 Đề bài:</h3>
                <p>Tạo hệ thống quản lý học sinh với các custom exception:</p>
                <ol>
                    <li><code class="inline">InvalidGradeException</code> - điểm không hợp lệ (0-10)</li>
                    <li><code class="inline">DuplicateStudentException</code> - học sinh đã tồn tại</li>
                    <li><code class="inline">StudentNotFoundException</code> - không tìm thấy học sinh</li>
                </ol>
            </div>

            <div class="toggle-content">
                <button class="toggle-btn" onclick="toggleContent(this, 'code2')">📝 Xem Code</button>
                <button class="toggle-btn" onclick="toggleContent(this, 'result2')">🖥️ Demo</button>

                <div id="code2" class="content-section">
                    <pre><code>import java.util.*;

// Custom Exceptions
class InvalidGradeException extends Exception {
    public InvalidGradeException(double grade) {
        super("Điểm không hợp lệ: " + grade + ". Điểm phải từ 0.0 đến 10.0");
    }
}

class DuplicateStudentException extends Exception {
    public DuplicateStudentException(String studentId) {
        super("Học sinh đã tồn tại với ID: " + studentId);
    }
}

class StudentNotFoundException extends Exception {
    public StudentNotFoundException(String studentId) {
        super("Không tìm thấy học sinh với ID: " + studentId);
    }
}

// Student class
class Student {
    private String id;
    private String name;
    private double grade;
    
    public Student(String id, String name, double grade) throws InvalidGradeException {
        this.id = id;
        this.name = name;
        setGrade(grade);  // Validate grade
    }
    
    public void setGrade(double grade) throws InvalidGradeException {
        if (grade < 0.0 || grade > 10.0) {
            throw new InvalidGradeException(grade);
        }
        this.grade = grade;
    }
    
    // Getters
    public String getId() { return id; }
    public String getName() { return name; }
    public double getGrade() { return grade; }
    
    @Override
    public String toString() {
        return String.format("Student{ID='%s', Name='%s', Grade=%.1f}", id, name, grade);
    }
}

// Student Manager
public class StudentManager {
    private Map<String, Student> students = new HashMap<>();
    
    public void addStudent(String id, String name, double grade) 
            throws DuplicateStudentException, InvalidGradeException {
        if (students.containsKey(id)) {
            throw new DuplicateStudentException(id);
        }
        
        Student student = new Student(id, name, grade);
        students.put(id, student);
        System.out.println("✅ Đã thêm: " + student);
    }
    
    public Student findStudent(String id) throws StudentNotFoundException {
        Student student = students.get(id);
        if (student == null) {
            throw new StudentNotFoundException(id);
        }
        return student;
    }
    
    public void updateGrade(String id, double newGrade) 
            throws StudentNotFoundException, InvalidGradeException {
        Student student = findStudent(id);
        student.setGrade(newGrade);
        System.out.println("✅ Đã cập nhật điểm: " + student);
    }
    
    public static void main(String[] args) {
        StudentManager manager = new StudentManager();
        
        try {
            // Test cases
            System.out.println("=== DEMO CUSTOM EXCEPTIONS ===\n");
            
            // Success cases
            manager.addStudent("SV001", "Nguyễn Văn A", 8.5);
            manager.addStudent("SV002", "Trần Thị B", 7.2);
            
            // Test find student
            Student found = manager.findStudent("SV001");
            System.out.println("🔍 Tìm thấy: " + found);
            
            // Test update grade
            manager.updateGrade("SV001", 9.0);
            
        } catch (DuplicateStudentException | InvalidGradeException | StudentNotFoundException e) {
            System.out.println("❌ " + e.getMessage());
        }
        
        // Test exception cases
        System.out.println("\n=== TEST EXCEPTION CASES ===");
        
        // Test invalid grade
        try {
            manager.addStudent("SV003", "Lê Văn C", 15.0);  // Invalid grade
        } catch (Exception e) {
            System.out.println("❌ " + e.getMessage());
        }
        
        // Test duplicate student
        try {
            manager.addStudent("SV001", "Duplicate", 5.0);  // Duplicate ID
        } catch (Exception e) {
            System.out.println("❌ " + e.getMessage());
        }
        
        // Test student not found
        try {
            manager.findStudent("SV999");  // Not found
        } catch (Exception e) {
            System.out.println("❌ " + e.getMessage());
        }
    }
}</code></pre>
                </div>

                <div id="result2" class="content-section">
                    <pre><code>$ javac StudentManager.java
$ java StudentManager
=== DEMO CUSTOM EXCEPTIONS ===

✅ Đã thêm: Student{ID='SV001', Name='Nguyễn Văn A', Grade=8.5}
✅ Đã thêm: Student{ID='SV002', Name='Trần Thị B', Grade=7.2}
🔍 Tìm thấy: Student{ID='SV001', Name='Nguyễn Văn A', Grade=8.5}
✅ Đã cập nhật điểm: Student{ID='SV001', Name='Nguyễn Văn A', Grade=9.0}

=== TEST EXCEPTION CASES ===
❌ Điểm không hợp lệ: 15.0. Điểm phải từ 0.0 đến 10.0
❌ Học sinh đã tồn tại với ID: SV001
❌ Không tìm thấy học sinh với ID: SV999</code></pre>
                </div>
            </div>
        </section>

        <!-- Slide 12: Try-with-Resources -->
        <section class="slide">
            <h2>9. Try-with-Resources (Java 7+)</h2>
            
            <div class="callout">
                <p><strong>Try-with-Resources</strong> tự động <mark>đóng resource</mark> sau khi sử dụng, ngay cả khi có exception xảy ra!</p>
            </div>

            <div class="code-comparison">
                <div class="code-block">
                    <div class="code-header error">❌ Cách cũ (verbose & error-prone)</div>
                    <div class="code-content">
<pre><code>public void readFileOldWay(String filename) {
    FileReader file = null;
    BufferedReader reader = null;
    
    try {
        file = new FileReader(filename);
        reader = new BufferedReader(file);
        String line = reader.readLine();
        System.out.println(line);
        
    } catch (IOException e) {
        System.out.println("Error: " + e.getMessage());
        
    } finally {
        // Phải manually close resources
        try {
            if (reader != null) reader.close();
            if (file != null) file.close();
        } catch (IOException e) {
            System.out.println("Error closing: " + e.getMessage());
        }
    }
}</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header success">✅ Try-with-Resources (clean & safe)</div>
                    <div class="code-content">
<pre><code>public void readFileNewWay(String filename) {
    // Resources được tự động đóng!
    try (FileReader file = new FileReader(filename);
         BufferedReader reader = new BufferedReader(file)) {
        
        String line = reader.readLine();
        System.out.println(line);
        
    } catch (IOException e) {
        System.out.println("Error: " + e.getMessage());
    }
    // Không cần finally block!
    // Resources đã được tự động close()
}</code></pre>
                    </div>
                </div>
            </div>

            <h3>🔧 Điều kiện sử dụng Try-with-Resources:</h3>
            <div class="two-columns">
                <div>
                    <div class="callout">
                        <p>Resource phải implement <code class="inline">AutoCloseable</code> interface:</p>
                        <ul>
                            <li>FileReader, FileWriter</li>
                            <li>BufferedReader, BufferedWriter</li>
                            <li>InputStream, OutputStream</li>
                            <li>Scanner</li>
                            <li>Database Connection, Statement</li>
                        </ul>
                    </div>
                </div>
                <div>
                    <h3>💡 Ví dụ với nhiều resources:</h3>
                    <pre><code>public void copyFile(String source, String dest) {
    try (FileReader input = new FileReader(source);
         FileWriter output = new FileWriter(dest);
         BufferedReader reader = new BufferedReader(input);
         BufferedWriter writer = new BufferedWriter(output)) {
        
        String line;
        while ((line = reader.readLine()) != null) {
            writer.write(line);
            writer.newLine();
        }
        
        System.out.println("✅ Copy file thành công!");
        
    } catch (IOException e) {
        System.out.println("❌ Lỗi copy file: " + e.getMessage());
    }
    // Tất cả 4 resources được tự động close theo thứ tự ngược lại
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Slide 13: Exception Best Practices -->
        <section class="slide">
            <h2>10. Exception Handling Best Practices</h2>
            
            <div class="three-columns">
                <div class="callout success">
                    <h3>✅ NÊN làm</h3>
                    <ul style="font-size: 0.9em;">
                        <li><strong>Specific Exceptions:</strong> Catch exception cụ thể nhất</li>
                        <li><strong>Meaningful Messages:</strong> Thông báo lỗi rõ ràng</li>
                        <li><strong>Log Properly:</strong> Ghi log với đủ thông tin</li>
                        <li><strong>Fail Fast:</strong> Validate input sớm</li>
                        <li><strong>Clean Resources:</strong> Dùng try-with-resources</li>
                        <li><strong>Document:</strong> Javadoc cho throws</li>
                    </ul>
                </div>
                <div class="callout error">
                    <h3>❌ TRÁNH làm</h3>
                    <ul style="font-size: 0.9em;">
                        <li><strong>Catch-all:</strong> <code>catch (Exception e)</code></li>
                        <li><strong>Empty Catch:</strong> Catch nhưng không xử lý</li>
                        <li><strong>printStackTrace():</strong> Trong production</li>
                        <li><strong>Exception for Control:</strong> Dùng exception để điều khiển flow</li>
                        <li><strong>Generic Messages:</strong> "Something went wrong"</li>
                        <li><strong>Swallow Exceptions:</strong> Bỏ qua exception</li>
                    </ul>
                </div>
                <div class="callout warning">
                    <h3>⚠️ CẨN THẬN</h3>
                    <ul style="font-size: 0.9em;">
                        <li><strong>Performance:</strong> Try-catch có cost</li>
                        <li><strong>Exception Chaining:</strong> Giữ nguyên nhân gốc</li>
                        <li><strong>Finally vs Return:</strong> Finally luôn chạy</li>
                        <li><strong>Checked Exception:</strong> Có thật sự cần thiết?</li>
                        <li><strong>Custom Exception:</strong> Không tạo quá nhiều</li>
                    </ul>
                </div>
            </div>

            <h3>💻 Code Examples:</h3>
            <div class="code-comparison">
                <div class="code-block">
                    <div class="code-header error">❌ Bad Practice</div>
                    <div class="code-content">
<pre><code>// Empty catch block
try {
    riskyOperation();
} catch (Exception e) {
    // ❌ Swallowing exception
}

// Too generic
catch (Exception e) {
    System.out.println("Error occurred");
    // ❌ No useful information
}

// Using exceptions for control flow
try {
    return array[index];
} catch (ArrayIndexOutOfBoundsException e) {
    return -1;  // ❌ Should check bounds first
}</code></pre>
                    </div>
                </div>
                <div class="code-block">
                    <div class="code-header success">✅ Good Practice</div>
                    <div class="code-content">
<pre><code>// Specific exception handling
try {
    processPayment(amount);
} catch (InsufficientFundsException e) {
    logger.warn("Payment failed - insufficient funds: {}", e.getMessage());
    notifyUser("Không đủ tiền trong tài khoản");
} catch (PaymentProcessingException e) {
    logger.error("Payment processing error", e);
    notifyUser("Lỗi xử lý thanh toán, vui lòng thử lại");
}

// Validation first
if (index >= 0 && index < array.length) {
    return array[index];
} else {
    throw new IllegalArgumentException("Invalid index: " + index);
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Slide 14: Real-world Example -->
        <section class="slide">
            <h2>11. Ví dụ thực tế: Web API Exception Handling</h2>
            
            <p>Xây dựng một REST API với exception handling chuyên nghiệp:</p>

            <div class="toggle-content">
                <button class="toggle-btn" onclick="toggleContent(this, 'api-code')">📝 Xem Code API</button>
                <button class="toggle-btn" onclick="toggleContent(this, 'api-demo')">🖥️ Demo</button>

                <div id="api-code" class="content-section">
                    <pre><code>import java.util.*;
import java.time.LocalDateTime;

// Custom API Exceptions
class ApiException extends Exception {
    private final int statusCode;
    private final String errorCode;
    
    public ApiException(int statusCode, String errorCode, String message) {
        super(message);
        this.statusCode = statusCode;
        this.errorCode = errorCode;
    }
    
    public int getStatusCode() { return statusCode; }
    public String getErrorCode() { return errorCode; }
}

class ValidationException extends ApiException {
    public ValidationException(String message) {
        super(400, "VALIDATION_ERROR", message);
    }
}

class ResourceNotFoundException extends ApiException {
    public ResourceNotFoundException(String resource, String id) {
        super(404, "RESOURCE_NOT_FOUND", resource + " with ID " + id + " not found");
    }
}

class BusinessLogicException extends ApiException {
    public BusinessLogicException(String message) {
        super(422, "BUSINESS_LOGIC_ERROR", message);
    }
}

// API Response Model
class ApiResponse<T> {
    private boolean success;
    private T data;
    private String message;
    private String errorCode;
    private LocalDateTime timestamp;
    
    private ApiResponse(boolean success, T data, String message, String errorCode) {
        this.success = success;
        this.data = data;
        this.message = message;
        this.errorCode = errorCode;
        this.timestamp = LocalDateTime.now();
    }
    
    public static <T> ApiResponse<T> success(T data) {
        return new ApiResponse<>(true, data, "Success", null);
    }
    
    public static <T> ApiResponse<T> error(String message, String errorCode) {
        return new ApiResponse<>(false, null, message, errorCode);
    }
    
    @Override
    public String toString() {
        return String.format("ApiResponse{success=%s, data=%s, message='%s', errorCode='%s', timestamp=%s}", 
                           success, data, message, errorCode, timestamp);
    }
}

// User Service with Exception Handling
class UserService {
    private Map<String, String> users = new HashMap<>();
    
    public UserService() {
        // Sample data
        users.put("user1", "Alice Johnson");
        users.put("user2", "Bob Smith");
    }
    
    public String createUser(String userId, String name) throws ValidationException, BusinessLogicException {
        // Input validation
        if (userId == null || userId.trim().isEmpty()) {
            throw new ValidationException("User ID không được để trống");
        }
        if (name == null || name.trim().isEmpty()) {
            throw new ValidationException("Tên user không được để trống");
        }
        if (userId.length() < 3) {
            throw new ValidationException("User ID phải có ít nhất 3 ký tự");
        }
        
        // Business logic validation
        if (users.containsKey(userId)) {
            throw new BusinessLogicException("User ID '" + userId + "' đã tồn tại");
        }
        
        users.put(userId, name);
        return "User created successfully";
    }
    
    public String getUser(String userId) throws ResourceNotFoundException {
        if (!users.containsKey(userId)) {
            throw new ResourceNotFoundException("User", userId);
        }
        return users.get(userId);
    }
    
    public void deleteUser(String userId) throws ResourceNotFoundException, BusinessLogicException {
        if (!users.containsKey(userId)) {
            throw new ResourceNotFoundException("User", userId);
        }
        
        // Business rule: không thể xóa user admin
        if ("admin".equals(userId)) {
            throw new BusinessLogicException("Không thể xóa user admin");
        }
        
        users.remove(userId);
    }
}

// API Controller with Global Exception Handling
public class UserController {
    private UserService userService = new UserService();
    
    public ApiResponse<String> handleCreateUser(String userId, String name) {
        try {
            String result = userService.createUser(userId, name);
            return ApiResponse.success(result);
            
        } catch (ValidationException e) {
            System.out.println("⚠️  Validation Error: " + e.getMessage());
            return ApiResponse.error(e.getMessage(), e.getErrorCode());
            
        } catch (BusinessLogicException e) {
            System.out.println("💼 Business Logic Error: " + e.getMessage());
            return ApiResponse.error(e.getMessage(), e.getErrorCode());
            
        } catch (Exception e) {
            System.out.println("🚨 Unexpected Error: " + e.getMessage());
            return ApiResponse.error("Internal Server Error", "INTERNAL_ERROR");
        }
    }
    
    public ApiResponse<String> handleGetUser(String userId) {
        try {
            String userName = userService.getUser(userId);
            return ApiResponse.success(userName);
            
        } catch (ResourceNotFoundException e) {
            System.out.println("🔍 Not Found: " + e.getMessage());
            return ApiResponse.error(e.getMessage(), e.getErrorCode());
            
        } catch (Exception e) {
            System.out.println("🚨 Unexpected Error: " + e.getMessage());
            return ApiResponse.error("Internal Server Error", "INTERNAL_ERROR");
        }
    }
    
    public static void main(String[] args) {
        UserController controller = new UserController();
        
        System.out.println("=== API EXCEPTION HANDLING DEMO ===\n");
        
        // Success cases
        System.out.println("1. ✅ Create user - Success:");
        System.out.println(controller.handleCreateUser("user3", "Charlie Brown"));
        
        System.out.println("\n2. ✅ Get user - Success:");
        System.out.println(controller.handleGetUser("user1"));
        
        // Error cases
        System.out.println("\n3. ❌ Create user - Validation Error:");
        System.out.println(controller.handleCreateUser("", "Empty ID"));
        
        System.out.println("\n4. ❌ Create user - Business Logic Error:");
        System.out.println(controller.handleCreateUser("user1", "Duplicate User"));
        
        System.out.println("\n5. ❌ Get user - Not Found:");
        System.out.println(controller.handleGetUser("nonexistent"));
    }
}</code></pre>
                </div>

                <div id="api-demo" class="content-section">
                    <pre><code>$ javac UserController.java
$ java UserController
=== API EXCEPTION HANDLING DEMO ===

1. ✅ Create user - Success:
ApiResponse{success=true, data=User created successfully, message='Success', errorCode='null', timestamp=2024-01-15T10:30:45.123}

2. ✅ Get user - Success:
ApiResponse{success=true, data=Alice Johnson, message='Success', errorCode='null', timestamp=2024-01-15T10:30:45.125}

3. ❌ Create user - Validation Error:
⚠️  Validation Error: User ID không được để trống
ApiResponse{success=false, data=null, message='User ID không được để trống', errorCode='VALIDATION_ERROR', timestamp=2024-01-15T10:30:45.127}

4. ❌ Create user - Business Logic Error:
💼 Business Logic Error: User ID 'user1' đã tồn tại
ApiResponse{success=false, data=null, message='User ID 'user1' đã tồn tại', errorCode='BUSINESS_LOGIC_ERROR', timestamp=2024-01-15T10:30:45.129}

5. ❌ Get user - Not Found:
🔍 Not Found: User with ID nonexistent not found
ApiResponse{success=false, data=null, message='User with ID nonexistent not found', errorCode='RESOURCE_NOT_FOUND', timestamp=2024-01-15T10:30:45.131}</code></pre>
                </div>
            </div>
        </section>

        <!-- Slide 15: Performance Considerations -->
        <section class="slide">
            <h2>12. Performance & Advanced Topics</h2>
            
            <div class="two-columns">
                <div>
                    <h3>⚡ Performance Considerations</h3>
                    <div class="callout warning">
                        <h4>Exception handling có cost!</h4>
                        <ul>
                            <li><strong>Stack trace creation</strong> tốn thời gian</li>
                            <li><strong>Try-catch blocks</strong> có overhead nhỏ</li>
                            <li><strong>Exception throwing</strong> rất chậm</li>
                        </ul>
                    </div>
                    
                    <h4>💡 Optimization Tips:</h4>
                    <ul>
                        <li><strong>Validate early:</strong> Tránh exceptions không cần thiết</li>
                        <li><strong>Cache exceptions:</strong> Tái sử dụng static exceptions</li>
                        <li><strong>Avoid deep stacks:</strong> Không nest try-catch quá sâu</li>
                        <li><strong>Use specific types:</strong> Tránh generic Exception</li>
                    </ul>

                    <pre><code>// ❌ Slow - using exceptions for control
public int findIndex(int[] arr, int value) {
    for (int i = 0; i < arr.length; i++) {
        try {
            if (arr[i] == value) return i;
        } catch (Exception e) {
            // This will never execute but still costs
        }
    }
    return -1;
}

// ✅ Fast - proper validation
public int findIndex(int[] arr, int value) {
    if (arr == null) return -1;
    for (int i = 0; i < arr.length; i++) {
        if (arr[i] == value) return i;
    }
    return -1;
}</code></pre>
                </div>
                <div>
                    <h3>🔗 Exception Chaining</h3>
                    <p>Giữ nguyên nhân gốc khi wrap exception:</p>
                    <pre><code>public void processData(String data) throws DataProcessingException {
    try {
        // Low-level operation
        parseData(data);
    } catch (NumberFormatException e) {
        // Chain the original exception
        throw new DataProcessingException(
            "Failed to process data: " + data, e);
    }
}

// Accessing chained exception
try {
    processData("invalid");
} catch (DataProcessingException e) {
    System.out.println("Main error: " + e.getMessage());
    
    Throwable cause = e.getCause();
    if (cause != null) {
        System.out.println("Root cause: " + cause.getMessage());
    }
}</code></pre>

                    <h3>🔍 Suppressed Exceptions</h3>
                    <p>Try-with-resources có thể có nhiều exceptions:</p>
                    <pre><code>try (AutoCloseableResource resource = new AutoCloseableResource()) {
    resource.doSomething();  // Throws Exception A
} catch (Exception e) {
    System.out.println("Primary: " + e.getMessage());
    
    // Check suppressed exceptions from close()
    Throwable[] suppressed = e.getSuppressed();
    for (Throwable s : suppressed) {
        System.out.println("Suppressed: " + s.getMessage());
    }
}</code></pre>

                    <h3>📊 Exception Metrics</h3>
                    <pre><code>// Monitor exception frequency
public class ExceptionMonitor {
    private static final Map<String, Integer> exceptionCounts = new HashMap<>();
    
    public static void recordException(Exception e) {
        String type = e.getClass().getSimpleName();
        exceptionCounts.merge(type, 1, Integer::sum);
    }
    
    public static void printStats() {
        exceptionCounts.forEach((type, count) -> 
            System.out.println(type + ": " + count + " occurrences"));
    }
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Slide 16: Tổng kết -->
        <section class="slide">
            <h2>📚 Tổng kết Exception Handling</h2>
            
            <div style="text-align: center; margin: 20px 0 30px;">
                <h3>🎯 Những điều quan trọng cần nhớ</h3>
            </div>

            <div class="three-columns">
                <div class="callout">
                    <h3>🏗️ Cơ bản</h3>
                    <ul style="font-size: 0.9em;">
                        <li><strong>Exception Hierarchy:</strong> Error vs Exception</li>
                        <li><strong>Try-Catch-Finally:</strong> Xử lý exceptions</li>
                        <li><strong>Checked vs Unchecked:</strong> Compile-time vs Runtime</li>
                        <li><strong>Throw vs Throws:</strong> Ném vs Khai báo</li>
                    </ul>
                </div>
                <div class="callout success">
                    <h3>🚀 Nâng cao</h3>
                    <ul style="font-size: 0.9em;">
                        <li><strong>Custom Exceptions:</strong> Business logic specific</li>
                        <li><strong>Try-with-Resources:</strong> Automatic resource management</li>
                        <li><strong>Exception Chaining:</strong> Preserve root cause</li>
                        <li><strong>Best Practices:</strong> Clean, meaningful handling</li>
                    </ul>
                </div>
                <div class="callout warning">
                    <h3>💼 Thực tế</h3>
                    <ul style="font-size: 0.9em;">
                        <li><strong>API Design:</strong> Consistent error responses</li>
                        <li><strong>Logging:</strong> Proper error tracking</li>
                        <li><strong>Performance:</strong> Exception cost awareness</li>
                        <li><strong>User Experience:</strong> Friendly error messages</li>
                    </ul>
                </div>
            </div>

            <div style="margin: 30px 0;">
                <h3>🔄 Exception Handling Flow:</h3>
                <div style="background: var(--panel); padding: 20px; border-radius: 8px; text-align: center; font-family: monospace; font-size: 0.9em;">
                    <div>🚀 Code Execution</div>
                    <div style="margin: 10px 0;">↓</div>
                    <div>⚠️ Exception Occurs</div>
                    <div style="margin: 10px 0;">↓</div>
                    <div>🔍 Search for Handler (catch block)</div>
                    <div style="margin: 10px 0;">↓</div>
                    <div style="display: flex; justify-content: center; gap: 20px;">
                        <div style="background: var(--success); color: white; padding: 5px 10px; border-radius: 4px;">
                            ✅ Handler Found<br>→ Execute catch block
                        </div>
                        <div style="background: var(--error); color: white; padding: 5px 10px; border-radius: 4px;">
                            ❌ No Handler<br>→ Propagate up
                        </div>
                    </div>
                    <div style="margin: 10px 0;">↓</div>
                    <div>🔒 Always execute finally</div>
                    <div style="margin: 10px 0;">↓</div>
                    <div>🏁 Continue or Terminate</div>
                </div>
            </div>

            <div class="callout" style="margin-top: 30px;">
                <h3>🎓 Bước tiếp theo:</h3>
                <p>Với Exception Handling trong tay, bạn đã sẵn sàng để:</p>
                <ul>
                    <li><strong>Collections Framework:</strong> ArrayList, HashMap, Set với error handling</li>
                    <li><strong>File I/O:</strong> Đọc/ghi file an toàn với try-with-resources</li>
                    <li><strong>Multi-threading:</strong> Exception handling trong môi trường đồng bộ</li>
                    <li><strong>Web Development:</strong> REST API error handling</li>
                    <li><strong>Database Programming:</strong> SQLException handling</li>
                </ul>
            </div>

            <p style="text-align: center; margin-top: 30px; color: var(--muted);">
                <strong>🏆 Chúc mừng! Bạn đã thành thạo Exception Handling trong Java! 🏆</strong>
            </p>
        </section>
    </div>

    <div class="footer">
        <div class="controls">
            <button id="prev" class="button">← Trước</button>
            <div class="progress"><span id="progress-bar"></span></div>
            <button id="next" class="button">Tiếp →</button>
        </div>
        <div id="slide-info" class="help">1 / 16</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const deck = document.getElementById('deck');
            const slides = Array.from(deck.getElementsByClassName('slide'));
            const prevBtn = document.getElementById('prev');
            const nextBtn = document.getElementById('next');
            const progressBar = document.getElementById('progress-bar');
            const slideInfo = document.getElementById('slide-info');
            let current = 0;

            function updateSlide() {
                slides.forEach((slide, i) => {
                    slide.classList.remove('active', 'prev');
                    if (i === current) {
                        slide.classList.add('active');
                    } else if (i < current) {
                        slide.classList.add('prev');
                    }
                });

                prevBtn.disabled = current === 0;
                nextBtn.disabled = current === slides.length - 1;

                const progress = (current / (slides.length - 1)) * 100;
                progressBar.style.width = `${progress}%`;
                slideInfo.textContent = `${current + 1} / ${slides.length}`;
            }

            function goToSlide(index) {
                if (index >= 0 && index < slides.length) {
                    current = index;
                    updateSlide();
                }
            }

            // Navigation event listeners
            prevBtn.addEventListener('click', () => goToSlide(current - 1));
            nextBtn.addEventListener('click', () => goToSlide(current + 1));

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowLeft':
                        goToSlide(current - 1);
                        break;
                    case 'ArrowRight':
                    case ' ':
                        e.preventDefault();
                        goToSlide(current + 1);
                        break;
                    case 'Home':
                        goToSlide(0);
                        break;
                    case 'End':
                        goToSlide(slides.length - 1);
                        break;
                    case 'Escape':
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        }
                        break;
                }
            });

            // Toggle content function for interactive exercises
            window.toggleContent = function(button, contentId) {
                const content = document.getElementById(contentId);
                const isShowing = content.classList.contains('show');

                if (isShowing) {
                    content.classList.remove('show');
                    button.textContent = button.textContent.replace('🔽 Ẩn', '📝 Xem').replace('🔽 Ẩn', '🖥️');
                } else {
                    content.classList.add('show');
                    if (button.textContent.includes('Code') || button.textContent.includes('📝')) {
                        button.textContent = '🔽 Ẩn Code';
                    } else {
                        button.textContent = '🔽 Ẩn Demo';
                    }
                }
            };

            // Initialize
            updateSlide();

            // Add smooth scrolling for slide content
            slides.forEach(slide => {
                slide.addEventListener('scroll', (e) => {
                    e.stopPropagation();
                });
            });
        });
    </script>
</body>

</html>
